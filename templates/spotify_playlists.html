<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Spotify Playlists</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body
  data-page-limit="{{ page_limit }}"
>
  <div class="container">
    <div class="page-head">
      <div>
        <h1>Your Spotify Playlists</h1>
        <div class="sub">Browse all of your playlists. Load more pages as needed.</div>
      </div>
      <div>
        <a class="btn secondary" href="{{ url_for('index') }}">Back to Portal</a>
      </div>
    </div>

    <div class="grid" id="playlists-grid">
      {% for playlist in playlists %}
      <div class="card" data-id="{{ playlist.id }}">
        <div class="card-top" style="display:flex;gap:12px;align-items:flex-start;width:100%;">
          <div class="cover">
            {% if playlist.images and playlist.images[0] %}
              <img data-src="{{ playlist.images[0].url }}" loading="lazy" alt="playlist cover" />
            {% else %}
              <svg width="72" height="72" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
                <rect width="24" height="24" rx="4" fill="rgba(255,255,255,0.03)"/>
              </svg>
            {% endif %}
          </div>

          <div class="card-content" style="flex:1 1 auto;min-width:0;">
            <a class="title view-link" href="{{ url_for('spotify_playlist', playlist_id=playlist.id) }}">{{ playlist.name }}</a>
            <div class="meta">{{ playlist.tracks.total }} tracks</div>
          </div>
        </div>

        <div class="actions">
          <a class="btn" href="{{ url_for('spotify_playlist', playlist_id=playlist.id) }}">Open</a>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Sentinel for infinite scroll -->
    <div id="scroll-sentinel" class="sentinel"></div>

    {% if total_playlists > page_limit %}
      <button id="load-more" class="load-more" data-offset="{{ page_limit }}">Load more playlists</button>
    {% endif %}

  </div>

  <script src="{{ url_for('static', filename='js/lazy-images.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/infinite-scroll.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/playlists.js') }}" defer></script>

</body>
</html>