<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>{{ playlist_name }}</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body
  data-playlist-id="{{ playlist_id }}"
  data-page-limit="{{ page_limit }}"
>
  <div class="container">
    <div class="page-head">
      <div>
        <h1>{{ playlist_name }}</h1>
        <div class="sub">{{ total_tracks }} tracks</div>
      </div>
      <div>
        <a class="btn secondary" href="{{ url_for('spotify_playlists') }}">Back to Playlists</a>
      </div>
    </div>

    <ul id="tracks-list" class="tracks">
    {% for track in tracks %}
      <li class="track">
        <div class="thumb">
          {% if track.album_img %}
            <!-- Use data-src for lazy-loading; also set loading attribute -->
            <img data-src="{{ track.album_img }}" loading="lazy" alt="album art" />
          {% else %}
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <rect width="24" height="24" rx="4" fill="rgba(255,255,255,0.03)"/>
            </svg>
          {% endif %}
        </div>
        <div class="info">
          <div class="name">{{ track.name }}</div>
          <div class="artists">{{ track.artists }}</div>
        </div>
        <div class="action">
          <a class="btn" href="{{ track.discogs_url }}" target="_blank" rel="noopener noreferrer">
            <span>ðŸ”Ž</span> Search Vinyl
          </a>
          <a class="btn" href="{{ track.album_search_url }}" target="_blank" rel="noopener noreferrer">
            <span>ðŸŽ¶</span> Search Album
          </a>
          <a class="btn" href="{{ track.artist_search_url }}" target="_blank" rel="noopener noreferrer">
            <span>ðŸŽ­</span> Search Artist
          </a>
        </div>
      </li>
    {% endfor %}
    </ul>

    <!-- Sentinel for infinite scroll -->
    <div id="tracks-sentinel" class="sentinel"></div>

    {% if total_tracks > page_limit %}
      <button id="load-more-tracks" class="load-more" data-offset="{{ initial_offset + tracks|length }}" data-limit="{{ page_limit }}" data-playlist-id="{{ playlist_id }}">Load more tracks</button>
    {% endif %}

  </div>

  <script src="{{ url_for('static', filename='js/lazy-images.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/infinite-scroll.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/tracks.js') }}" defer></script>


</body>
</html>